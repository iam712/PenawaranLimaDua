<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form Penawaran Barang</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f4f4f9;
        color: #333;
      }

      h2 {
        color: #333;
        margin-bottom: 20px;
        text-align: center;
      }

      .company-header img {
        max-width: 100%;
        height: auto;
      }

      form {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        max-width: 900px;
        margin: 0 auto;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
        border-radius: 8px;
        overflow: hidden;
      }

      table,
      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
      }

      th {
        background-color: #f8f9fa;
        text-align: left;
        color: #495057;
      }

      td {
        background-color: #ffffff;
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      input[type="file"] {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border-radius: 4px;
        border: 1px solid #ccc;
        margin-bottom: 10px;
      }

      select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
        border-radius: 4px;
        border: 1px solid #ccc;
        margin-bottom: 20px;
      }

      button {
        padding: 10px 20px;
        background-color: #28a745;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.3s ease;
        margin-bottom: 10px;
      }

      button:hover {
        background-color: #218838;
      }

      button.remove {
        background-color: #dc3545;
      }

      button.remove:hover {
        background-color: #c82333;
      }

      button.clear {
        background-color: #007bff;
      }

      button.clear:hover {
        background-color: #0069d9;
      }

      .total-section {
        text-align: right;
      }

      .total-section label {
        font-weight: bold;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 100;
        padding-top: 60px;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 20px;
        border: 1px solid #888;
        border-radius: 8px;
        width: 80%;
        position: relative;
      }

      .close {
        color: #aaa;
        position: absolute;
        top: 10px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover,
      .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
      }

      .download-icon {
        font-size: 24px;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <h2>Form Penawaran Barang</h2>

    <form id="penawaran-form">
      <label for="kop-surat">Upload Kop Surat:</label>
      <input type="file" id="kop-surat" accept="image/*" /><br />

      <label for="tanggal-faktur">Tanggal Faktur:</label>
      <input type="date" id="tanggal-faktur" name="tanggal-faktur" /><br />

      <label for="nomor-penawaran">Nomor Penawaran:</label>
      <input type="text" id="nomor-penawaran" name="nomor-penawaran" /><br />

      <label for="perihal">Perihal:</label>
      <input type="text" id="perihal" name="perihal" /><br />

      <label for="nama-penerima">Nama Penerima:</label>
      <input type="text" id="nama-penerima" name="nama-penerima" /><br />

      <label for="nama-perusahaan">Nama Perusahaan:</label>
      <input type="text" id="nama-perusahaan" name="nama-perusahaan" /><br />

      <label for="tanggal-jatuh-tempo">Tanggal Jatuh Tempo:</label>
      <input
        type="date"
        id="tanggal-jatuh-tempo"
        name="tanggal-jatuh-tempo"
      /><br />

      <table id="items-table">
        <thead>
          <tr>
            <th>No.</th>
            <th>Item</th>
            <th>Qty</th>
            <th colspan="2">Ukuran (CM)</th>
            <th>Harga Satuan (Rp.)</th>
            <th>Total Harga (Rp.)</th>
            <th>Aksi</th>
          </tr>
          <tr>
            <th></th>
            <th></th>
            <th></th>
            <th>P</th>
            <th>L</th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>1</td>
            <td>
              <input type="text" name="item[]" placeholder="Nama barang" />
            </td>
            <td>
              <input
                type="number"
                name="qty[]"
                placeholder="Kuantitas"
                oninput="calculateTotal(this)"
              />
            </td>
            <td>
              <input
                type="number"
                name="ukuran_p[]"
                placeholder="Panjang"
                oninput="calculateTotal(this)"
              />
            </td>
            <td>
              <input
                type="number"
                name="ukuran_l[]"
                placeholder="Lebar"
                oninput="calculateTotal(this)"
              />
            </td>
            <td>
              <input
                type="number"
                name="harga_satuan[]"
                placeholder="Harga Satuan"
                oninput="calculateTotal(this)"
              />
            </td>
            <td>
              <input
                type="text"
                name="total_harga[]"
                placeholder="Total Harga"
                readonly
              />
            </td>
            <td>
              <button type="button" class="remove" onclick="removeRow(this)">
                Hapus
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <button type="button" onclick="addRow()">Tambah Barang</button><br />

      <div class="total-section">
        <label for="grand_total">Grand Total (Rp):</label>
        <input type="text" id="grand_total" readonly /><br />
      </div>

      <button type="button" onclick="openPreview()">Preview Penawaran</button>
      <button type="button" onclick="downloadPDF()">Download PDF</button>
      <button type="button" class="clear" onclick="clearForm()">
        Hapus Isi Form
      </button>
    </form>

    <!-- Modal untuk Preview -->
    <div id="previewModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closePreview()">&times;</span>
        <h3>Preview Penawaran Barang</h3>
        <div id="penawaran-preview-content"></div>
        <br />
        <button type="button" onclick="downloadPDF()">
          <i class="download-icon">ðŸ’¾ Download PDF</i>
        </button>
      </div>
    </div>

    <!-- Tambahkan pustaka html2pdf -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>

    <script>
      function addRow() {
        var table = document
          .getElementById("items-table")
          .getElementsByTagName("tbody")[0];
        var rowCount = table.rows.length;
        var newRow = table.insertRow();

        var cell1 = newRow.insertCell(0);
        var cell2 = newRow.insertCell(1);
        var cell3 = newRow.insertCell(2);
        var cell4 = newRow.insertCell(3);
        var cell5 = newRow.insertCell(4);
        var cell6 = newRow.insertCell(5);
        var cell7 = newRow.insertCell(6);
        var cell8 = newRow.insertCell(7);

        cell1.innerHTML = rowCount + 1;
        cell2.innerHTML =
          '<input type="text" name="item[]" placeholder="Nama barang">';
        cell3.innerHTML =
          '<input type="number" name="qty[]" placeholder="Kuantitas" oninput="calculateTotal(this)">';
        cell4.innerHTML =
          '<input type="number" name="ukuran_p[]" placeholder="Panjang" oninput="calculateTotal(this)">';
        cell5.innerHTML =
          '<input type="number" name="ukuran_l[]" placeholder="Lebar" oninput="calculateTotal(this)">';
        cell6.innerHTML =
          '<input type="number" name="harga_satuan[]" placeholder="Harga Satuan" oninput="calculateTotal(this)">';
        cell7.innerHTML =
          '<input type="text" name="total_harga[]" placeholder="Total Harga" readonly>';
        cell8.innerHTML =
          '<button type="button" class="remove" onclick="removeRow(this)">Hapus</button>';
      }

      function removeRow(button) {
        var row = button.parentElement.parentElement;
        row.parentElement.removeChild(row);
        calculateGrandTotal();
      }

      function calculateTotal(element) {
        var row = element.parentElement.parentElement;
        var qty = row.querySelector('input[name="qty[]"]').value;
        var panjang = row.querySelector('input[name="ukuran_p[]"]').value;
        var lebar = row.querySelector('input[name="ukuran_l[]"]').value;
        var hargaSatuan = row.querySelector(
          'input[name="harga_satuan[]"]'
        ).value;
        var totalHarga = row.querySelector('input[name="total_harga[]"]');

        if (qty && panjang && lebar && hargaSatuan) {
          var totalAmount = qty * panjang * lebar * hargaSatuan;
          totalHarga.value = totalAmount.toLocaleString("id-ID", {
            style: "currency",
            currency: "IDR",
          });
        } else {
          totalHarga.value = "Rp0";
        }

        calculateGrandTotal();
      }

      function calculateGrandTotal() {
        var rows = document.querySelectorAll("#items-table tbody tr");
        var grandTotal = 0;

        rows.forEach(function (row) {
          var totalHarga = row
            .querySelector('input[name="total_harga[]"]')
            .value.replace(/[^0-9,-]+/g, "");
          grandTotal += parseFloat(totalHarga) || 0;
        });

        document.getElementById("grand_total").value =
          grandTotal.toLocaleString("id-ID", {
            style: "currency",
            currency: "IDR",
          });
      }

      function openPreview() {
        document.getElementById("previewModal").style.display = "block";
        previewPenawaran();
      }

      function closePreview() {
        document.getElementById("previewModal").style.display = "none";
      }

      function previewPenawaran() {
        // Code to generate and display the preview of the offer form
        var kopSurat = document.getElementById("kop-surat").files[0];
        var tanggalFaktur = document.getElementById("tanggal-faktur").value;
        var nomorPenawaran = document.getElementById("nomor-penawaran").value;
        var perihal = document.getElementById("perihal").value;
        var namaPenerima = document.getElementById("nama-penerima").value;
        var namaPerusahaan = document.getElementById("nama-perusahaan").value; // Nama Perusahaan
        var grandTotal = document.getElementById("grand_total").value;

        var reader = new FileReader();
        reader.onload = function (e) {
          var kopSuratHTML = kopSurat
            ? '<img src="' +
              e.target.result +
              '" alt="Kop Surat" style="max-width: 100%; height: auto; display: block; margin: 0 auto;" />'
            : "";

          var previewContent =
            kopSuratHTML +
            "<hr>" +
            "<p>Tanggal : " +
            tanggalFaktur +
            "</p><br>" + // Jarak antara Tanggal dan Nomor Penawaran
            "<p>Nomor Penawaran : " +
            nomorPenawaran +
            "</p>" +
            "<p>Hal : " +
            perihal +
            "</p>" +
            "<br>" + // Jarak antara Perihal dan Kepada Yth,
            "<p>Kepada Yth,</p>" +
            "<p>" +
            namaPenerima +
            "</p>" +
            "<p> Purchasing " +
            namaPerusahaan +
            "</p>" + // Menambahkan Nama Perusahaan sebelum "Di Tempat"
            "<p>Di Tempat</p><br>" +
            "<p>Dengan Hormat, </p>" +
            "<p>Bersama surat ini kami mengajukan " +
            perihal +
            "dengan rincian sebagai berikut.</p><br>" +
            "<hr>" +
            generateItemsTable() +
            "<hr>" +
            "<p>Grand Total : " +
            grandTotal +
            "</p><br>" +
            "<p> Keterangan : </p>" +
            "<p> Penawaran harga berlaku untuk 2 minggu, setelah itu harga menyesuaikan kembali.</p><br>" +
            "<p> Demikian Surat Penawaran ini kami sampaikan, besar harapan kami untuk dapat kerjasama.</p>" +
            "<p> Atas peprhatian dan kesempatan yang telah diberikan. Kami ucapkan terima kasih. </p><br>"+
            "<p> Hormat Kami,</p>";

          document.getElementById("penawaran-preview-content").innerHTML =
            previewContent;
        };
        if (kopSurat) {
          reader.readAsDataURL(kopSurat);
        } else {
          var previewContent =
            "<hr>" +
            "<p>Tanggal : " +
            tanggalFaktur +
            "</p><br>" + // Jarak antara Tanggal dan Nomor Penawaran
            "<p>Nomor Penawaran : " +
            nomorPenawaran +
            "</p>" +
            "<p>Hal : " +
            perihal +
            "</p>" +
            "<br>" + // Jarak antara Perihal dan Kepada Yth,
            "<p>Kepada Yth,</p>" +
            "<p>" +
            namaPenerima +
            "</p>" +
            "<p> Purchasing " +
            namaPerusahaan +
            "</p>" + // Menambahkan Nama Perusahaan sebelum "Di Tempat"
            "<p>Di Tempat</p><br>" +
            "<p>Dengan Hormat, </p>" +
            "<p>Bersama surat ini kami mengajukan " +
            perihal +
            "dengan rincian sebagai berikut.</p><br>" +
            "<hr>" +
            generateItemsTable() +
            "<hr>" +
            "<p>Grand Total : " +
            grandTotal +
            "</p>";

          document.getElementById("penawaran-preview-content").innerHTML =
            previewContent;
        }
      }

      function generateItemsTable() {
        var items = document.querySelectorAll("#items-table tbody tr");
        var itemHTML =
          '<table border="1" style="border-collapse: collapse; width: 100%;"><tr><th>No.</th><th>Item</th><th>Qty</th><th>P</th><th>L</th><th>Harga Satuan (Rp.)</th><th>Total Harga (Rp.)</th></tr>';

        items.forEach(function (row, index) {
          var item = row.querySelector('input[name="item[]"]').value;
          var qty = row.querySelector('input[name="qty[]"]').value;
          var ukuranP = row.querySelector('input[name="ukuran_p[]"]').value;
          var ukuranL = row.querySelector('input[name="ukuran_l[]"]').value;
          var hargaSatuan = row.querySelector(
            'input[name="harga_satuan[]"]'
          ).value;
          var totalHarga = row.querySelector(
            'input[name="total_harga[]"]'
          ).value;

          itemHTML +=
            "<tr><td>" +
            (index + 1) +
            "</td><td>" +
            item +
            "</td><td>" +
            qty +
            "</td><td>" +
            ukuranP +
            "</td><td>" +
            ukuranL +
            "</td><td>" +
            hargaSatuan +
            "</td><td>" +
            totalHarga +
            "</td></tr>";
        });

        itemHTML += "</table>";
        return itemHTML;
      }

      function downloadPDF() {
        var element = document.getElementById("penawaran-preview-content");
        var opt = {
          margin: [10, 10], // Margin (top, left, right, bottom)
          filename: "penawaran-barang.pdf",
          image: { type: "jpeg", quality: 0.98 },
          html2canvas: { scale: 2 },
          jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }, // A4 size in portrait orientation
        };
        html2pdf().from(element).set(opt).save();
      }

      function clearForm() {
        // Menghapus semua isi input form
        document.getElementById("penawaran-form").reset();

        // Reset tabel barang
        var tableBody = document.querySelector("#items-table tbody");
        tableBody.innerHTML = `<tr>
          <td>1</td>
          <td><input type="text" name="item[]" placeholder="Nama barang"></td>
          <td><input type="number" name="qty[]" placeholder="Kuantitas" oninput="calculateTotal(this)"></td>
          <td><input type="number" name="ukuran_p[]" placeholder="Panjang" oninput="calculateTotal(this)"></td>
          <td><input type="number" name="ukuran_l[]" placeholder="Lebar" oninput="calculateTotal(this)"></td>
          <td><input type="number" name="harga_satuan[]" placeholder="Harga Satuan" oninput="calculateTotal(this)"></td>
          <td><input type="text" name="total_harga[]" placeholder="Total Harga" readonly></td>
          <td><button type="button" class="remove" onclick="removeRow(this)">Hapus</button></td>
        </tr>`;

        // Sembunyikan preview
        document.getElementById("previewModal").style.display = "none";

        // Reset grand total
        document.getElementById("grand_total").value = "";
      }

      // Close modal jika klik di luar modal
      window.onclick = function (event) {
        var modal = document.getElementById("previewModal");
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };
    </script>
  </body>
</html>
